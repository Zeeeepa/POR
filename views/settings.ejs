<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings | Depla Project Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    .connection-status {
      display: inline-flex;
      align-items: center;
      font-size: 0.875rem;
    }
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 6px;
    }
    .status-connected {
      background-color: #198754;
    }
    .status-disconnected {
      background-color: #dc3545;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">Depla Project Manager</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/projects">Projects</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/settings">Settings</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <h1 class="mb-4">Settings</h1>
    
    <div class="row">
      <div class="col-md-3">
        <div class="list-group mb-4">
          <a href="#github-settings" class="list-group-item list-group-item-action active" data-bs-toggle="list">GitHub Settings</a>
          <a href="#slack-settings" class="list-group-item list-group-item-action" data-bs-toggle="list">Slack Settings</a>
          <a href="#general-settings" class="list-group-item list-group-item-action" data-bs-toggle="list">General Settings</a>
        </div>
      </div>
      
      <div class="col-md-9">
        <div class="tab-content">
          <!-- GitHub Settings -->
          <div class="tab-pane fade show active" id="github-settings">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">GitHub Settings</h5>
              </div>
              <div class="card-body">
                <form action="/settings" method="POST">
                  <div class="mb-3">
                    <label for="github-username" class="form-label">GitHub Username</label>
                    <input type="text" class="form-control" id="github-username" name="github[username]" value="<%= config.github ? config.github.username : '' %>">
                    <div class="form-text">Your GitHub username</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="github-token" class="form-label">Personal Access Token</label>
                    <input type="password" class="form-control" id="github-token" name="github[token]" value="<%= config.github && config.github.token ? '••••••••••••••••' : '' %>">
                    <div class="form-text">GitHub Personal Access Token for repository operations. If not provided here, it will be loaded from the .env file or you will be prompted to enter it when starting the application.</div>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">Save Settings</button>
                </form>
              </div>
            </div>
          </div>
          
          <!-- Slack Settings -->
          <div class="tab-pane fade" id="slack-settings">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Slack Settings</h5>
              </div>
              <div class="card-body">
                <form action="/settings" method="POST">
                  <div class="mb-3">
                    <label for="slack-channel" class="form-label">Default Channel</label>
                    <input type="text" class="form-control" id="slack-channel" name="slack[channel]" value="<%= config.slack ? config.slack.channel : '#project-development' %>">
                    <div class="form-text">The default Slack channel to use</div>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">Save Settings</button>
                </form>
              </div>
            </div>
          </div>
          
          <!-- General Settings -->
          <div class="tab-pane fade" id="general-settings">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">General Settings</h5>
              </div>
              <div class="card-body">
                <form action="/settings" method="POST">
                  <div class="mb-3">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" role="switch" id="auto-start" name="general[autoStart]" <%= config.general && config.general.autoStart ? 'checked' : '' %>>
                      <label class="form-check-label" for="auto-start">Auto-start processing</label>
                    </div>
                    <div class="form-text">Automatically start processing when loading a project</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="message-delay" class="form-label">Message Delay (ms)</label>
                    <input type="number" class="form-control" id="message-delay" name="messageDelay" value="<%= config.messageDelay || 5000 %>">
                    <div class="form-text">Delay between messages when sending batches (in milliseconds)</div>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">Save Settings</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="settings-container">
    <!-- Input Configuration -->
    <div class="settings-section">
      <h2>Input Configuration</h2>
      <div class="input-locations">
        <h3>Input Locations</h3>
        <div class="location-list" id="locationList">
          <!-- Input locations will be listed here -->
        </div>
        <button id="addLocationBtn" class="btn btn-primary">Add Input Location</button>
      </div>
    </div>

    <!-- Template Management -->
    <div class="settings-section">
      <h2>Template Management</h2>
      
      <!-- Template Categories -->
      <div class="template-categories">
        <h3>Template Categories</h3>
        <div class="category-list">
          <div class="category-item">
            <h4>Initialization Templates</h4>
            <div class="template-list" id="initTemplates">
              <!-- Init templates listed here -->
            </div>
          </div>
          <div class="category-item">
            <h4>Feature Development Templates</h4>
            <div class="template-list" id="featureTemplates">
              <!-- Feature templates listed here -->
            </div>
          </div>
          <div class="category-item">
            <h4>Validation Templates</h4>
            <div class="template-list" id="validationTemplates">
              <!-- Validation templates listed here -->
            </div>
          </div>
          <div class="category-item">
            <h4>Refinement Templates</h4>
            <div class="template-list" id="refinementTemplates">
              <!-- Refinement templates listed here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Template Variables -->
      <div class="template-variables">
        <h3>Template Variables</h3>
        <div class="variable-list" id="variableList">
          <!-- Variables will be listed here -->
        </div>
        <button id="addVariableBtn" class="btn btn-secondary">Add Variable</button>
      </div>
    </div>

    <!-- Phase Configuration -->
    <div class="settings-section">
      <h2>Phase Configuration</h2>
      
      <!-- Default Phase Settings -->
      <div class="phase-defaults">
        <h3>Default Phase Settings</h3>
        <form id="phaseDefaultsForm">
          <div class="form-group">
            <label>Auto-merge Threshold</label>
            <input type="number" id="autoMergeThreshold" class="form-control">
          </div>
          <div class="form-group">
            <label>Maximum Concurrent Features</label>
            <input type="number" id="maxConcurrentFeatures" class="form-control">
          </div>
          <div class="form-group">
            <label>Default Code Analysis</label>
            <div class="toggle-switch">
              <input type="checkbox" id="defaultCodeAnalysis">
              <span class="toggle-label">Enable by default</span>
            </div>
          </div>
        </form>
      </div>

      <!-- Phase Templates -->
      <div class="phase-templates">
        <h3>Phase Templates</h3>
        <div class="template-list" id="phaseTemplates">
          <!-- Phase templates listed here -->
        </div>
        <button id="addPhaseTemplateBtn" class="btn btn-secondary">Add Phase Template</button>
      </div>
    </div>

    <!-- GitHub Integration -->
    <div class="settings-section">
      <h2>GitHub Integration</h2>
      
      <!-- Repository Settings -->
      <div class="repo-settings">
        <h3>Repository Settings</h3>
        <form id="repoSettingsForm">
          <div class="form-group">
            <label>Default Branch</label>
            <input type="text" id="defaultBranch" class="form-control">
          </div>
          <div class="form-group">
            <label>PR Naming Convention</label>
            <input type="text" id="prNamingConvention" class="form-control">
          </div>
          <div class="form-group">
            <label>Auto-merge Rules</label>
            <textarea id="autoMergeRules" class="form-control"></textarea>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Input Location Modal -->
  <div id="inputLocationModal" class="modal">
    <div class="modal-content">
      <h3>Configure Input Location</h3>
      <form id="locationForm">
        <div class="form-group">
          <label>Location Name</label>
          <input type="text" id="locationName" class="form-control" required>
        </div>
        <div class="form-group">
          <label>X Coordinate</label>
          <input type="number" id="xCoord" class="form-control" required>
        </div>
        <div class="form-group">
          <label>Y Coordinate</label>
          <input type="number" id="yCoord" class="form-control" required>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">Save Location</button>
          <button type="button" class="btn btn-secondary" id="cancelLocation">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Template Editor Modal -->
  <div id="templateEditorModal" class="modal">
    <div class="modal-content">
      <h3>Edit Template</h3>
      <form id="templateForm">
        <div class="form-group">
          <label>Template Name</label>
          <input type="text" id="templateName" class="form-control" required>
        </div>
        <div class="form-group">
          <label>Category</label>
          <select id="templateCategory" class="form-select" required>
            <option value="init">Initialization</option>
            <option value="feature">Feature Development</option>
            <option value="validation">Validation</option>
            <option value="refinement">Refinement</option>
          </select>
        </div>
        <div class="form-group">
          <label>Template Content</label>
          <textarea id="templateContent" class="form-control" required></textarea>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">Save Template</button>
          <button type="button" class="btn btn-secondary" id="cancelTemplate">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
